SELECT
	name,
	object_id
FROM
	sys.procedures;

CREATE PROCEDURE SP_RetornarFaixaSalarial

@CD_CARGO INT,

@CD_ESCOLARIDADE INT,

@MIN DECIMAL(10,
2) OUTPUT,

@MAX DECIMAL(10,
2) OUTPUT

AS

BEGIN

SELECT
	@MIN = MENOR_VALOR,
	@MAX = MAIOR_VALOR
FROM
	TB_FAIXASALARIAL
WHERE
	CD_CARGO = @CD_CARGO
	AND CD_ESCOLARIDADE = @CD_ESCOLARIDADE;
END;

CREATE PROCEDURE SP_RetornarCodigoCargoEscolaridade

@NomeCargo VARCHAR(20),

@NomeEscolaridade VARCHAR(20),

@CodigoCargo INT OUTPUT,

@CodigoEscolaridade INT OUTPUT

AS

BEGIN
-- Mapeamento para o código do cargo

IF @NomeCargo = 'ANALISTA'

BEGIN

SET
@CodigoCargo = 1;
END
ELSE IF @NomeCargo = 'DBA'

BEGIN

SET
@CodigoCargo = 2;
END
ELSE IF @NomeCargo = 'PROGRAMADOR'

BEGIN

SET
@CodigoCargo = 3;
END
ELSE

BEGIN

PRINT 'Cargo inválido';

SET
@CodigoCargo = NULL;
END
-- Mapeamento para o código da escolaridade

IF @NomeEscolaridade = 'NIVEL MEDIO'

BEGIN

SET
@CodigoEscolaridade = 1;
END
ELSE IF @NomeEscolaridade = 'NIVEL SUPERIOR'

BEGIN

SET
@CodigoEscolaridade = 2;
END
ELSE IF @NomeEscolaridade = 'POS-GRADUACAO'

BEGIN

SET
@CodigoEscolaridade = 3;
END
END;

CREATE PROCEDURE SP_CHECARSALARIO(

@CODCARGO INT,

@CodEscolaridade INT,

@SALARIO DECIMAL(10,
2),

@BOLEANO INT OUTPUT

)

AS

BEGIN

DECLARE @MAX DECIMAL(10,
2);

DECLARE @MIN DECIMAL(10,
2);

DECLARE @i INT = 1;
-- Inicialização do contador

DECLARE @N INT = 3;
-- Valor final



WHILE @I <= @N

BEGIN

IF @CODCARGO = @I

BEGIN

EXEC SP_RetornarFaixaSalarial

@CD_CARGO = @CODCARGO,

@CD_ESCOLARIDADE = @CodEscolaridade,

@MIN = @MIN OUTPUT,

@MAX = @MAX OUTPUT;

IF @SALARIO <= @MAX
AND @SALARIO >= @MIN

BEGIN

SET
@BOLEANO = 1;

PRINT 'SALARIO CERTO!';
END
ELSE

BEGIN

SET
@BOLEANO = 0;

PRINT 'SALARIO ERRADO!'
END
END

SET
@I = @I + 1;
END
END

CREATE PROCEDURE CHECARFUNCIONARIO

AS

BEGIN

DECLARE @MATRICULA INT;

DECLARE @CARGO INT;

DECLARE @ESCOLARIDADE INT;

DECLARE @SALARIO NUMERIC(10,
2);

DECLARE @BOLEANO INT;

DECLARE FUNCIONARIO_CURSOR CURSOR FOR

SELECT
	MATRICULA,
	CD_CARGO,
	CD_ESCOLARIDADE,
	SALARIO
FROM
	TB_FUNCIONARIO;

OPEN FUNCIONARIO_CURSOR;

FETCH NEXT
FROM
FUNCIONARIO_CURSOR
INTO
	@MATRICULA,
	@CARGO,
	@ESCOLARIDADE,
	@SALARIO;

WHILE @@FETCH_STATUS = 0

BEGIN

EXEC SP_CHECARSALARIO @CARGO,
@ESCOLARIDADE,
@SALARIO,
@BOLEANO OUTPUT;

print @boleano

IF @BOLEANO = 0

BEGIN

INSERT
	INTO
	TB_LOG_FUNCIONARIO (MATRICULA,
	ERRO,
	DATA_ERRO)
VALUES (@MATRICULA,
'SALARIO ERRADO',
GETDATE());
END



FETCH NEXT
FROM
FUNCIONARIO_CURSOR
INTO
	@MATRICULA,
	@CARGO,
	@ESCOLARIDADE,
	@SALARIO;
END



CLOSE FUNCIONARIO_CURSOR;

DEALLOCATE FUNCIONARIO_CURSOR;
END