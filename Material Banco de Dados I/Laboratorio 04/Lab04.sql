/* Criacao de Tabelas */

CREATE DATABASE LAB04;

use lab04

DROP TABLE IF EXISTS TB_ALUNOS_TURMA
DROP TABLE IF EXISTS TB_TURMA
DROP TABLE IF EXISTS TB_ALUNO
DROP TABLE IF EXISTS TB_PROFESSOR


-- Tabela Aluno
CREATE TABLE TB_ALUNO (
  MATRICULA INT NOT NULL,
  NOME VARCHAR(40) NOT NULL,
  DT_NASCIMENTO DATETIME NOT NULL
);

ALTER TABLE TB_ALUNO ADD CONSTRAINT PK_ALUNO
PRIMARY KEY (MATRICULA)

-- Tabela Professor
CREATE TABLE TB_PROFESSOR (
  MATRICULA_PROFESSOR INT NOT NULL,
  NM_PROFESSOR VARCHAR(50) NOT NULL,
  TELEFONE VARCHAR(20) NULL
)

ALTER TABLE TB_PROFESSOR ADD CONSTRAINT PK_PROFESSOR
PRIMARY KEY (MATRICULA_PROFESSOR)

-- Tabela Turma
CREATE TABLE TB_TURMA (
  COD_TURMA INT NOT NULL,
  NM_TURMA VARCHAR(50) NOT NULL,
  HORARIO VARCHAR(50) NOT NULL,
  MATRICULA_PROFESSOR INT NOT NULL
)

ALTER TABLE TB_TURMA ADD CONSTRAINT PK_TURMA
PRIMARY KEY (COD_TURMA)

ALTER TABLE TB_TURMA ADD CONSTRAINT FK_MATRICULA_PROFESSOR
FOREIGN KEY (MATRICULA_PROFESSOR) 
REFERENCES TB_PROFESSOR (MATRICULA_PROFESSOR)

-- Tabela Alunos_Turma
CREATE TABLE TB_ALUNOS_TURMA (
  MATRICULA INT NOT NULL,
  COD_TURMA INT NOT NULL,
  PRIMARY KEY (MATRICULA, COD_TURMA)
)

ALTER TABLE TB_ALUNOS_TURMA ADD CONSTRAINT FK_MATRICULA
FOREIGN KEY (MATRICULA) 
REFERENCES TB_ALUNO (MATRICULA)

ALTER TABLE TB_ALUNOS_TURMA ADD CONSTRAINT FK_COD_TURMA
FOREIGN KEY (COD_TURMA) 
REFERENCES TB_TURMA (COD_TURMA)

/* Inclusao de Dados */


-- Tabela Aluno
INSERT INTO TB_ALUNO(MATRICULA, NOME, DT_NASCIMENTO) 
VALUES (10, 'JOAO', '19820412')

INSERT INTO TB_ALUNO(MATRICULA, NOME, DT_NASCIMENTO) 
VALUES (20, 'RICARDO', '19820601')

INSERT INTO TB_ALUNO(MATRICULA, NOME, DT_NASCIMENTO) 
VALUES (30, 'CARLA', '19800807')

INSERT INTO TB_ALUNO(MATRICULA, NOME, DT_NASCIMENTO) 
VALUES (40, 'MAURICIO', '19760201')

-- Tabela Professor
INSERT INTO TB_PROFESSOR(MATRICULA_PROFESSOR, NM_PROFESSOR, TELEFONE)
VALUES (901, 'JOSE AUGUSTO','8888-9999')

INSERT INTO TB_PROFESSOR(MATRICULA_PROFESSOR, NM_PROFESSOR, TELEFONE)
VALUES (902, 'MARIO ARAUJO','9997-6556')

INSERT INTO TB_PROFESSOR(MATRICULA_PROFESSOR, NM_PROFESSOR, TELEFONE)
VALUES (903, 'CARLA PATRICIA','9888-6888')

-- Tabela Turma
INSERT INTO TB_TURMA(COD_TURMA, NM_TURMA, HORARIO, MATRICULA_PROFESSOR)
VALUES(201, 'TURMA DIREITO CIVIL', '20:00',901)

INSERT INTO TB_TURMA(COD_TURMA, NM_TURMA, HORARIO, MATRICULA_PROFESSOR)
VALUES(202, 'TURMA DIREITO TRIBUTARIO', '18:00',902)

-- Tabela Alunos_Turma

INSERT INTO TB_ALUNOS_TURMA (MATRICULA, COD_TURMA)
VALUES (10, 201)

INSERT INTO TB_ALUNOS_TURMA (MATRICULA, COD_TURMA)
VALUES (20, 201)

INSERT INTO TB_ALUNOS_TURMA (MATRICULA, COD_TURMA)
VALUES (30, 201)

INSERT INTO TB_ALUNOS_TURMA (MATRICULA, COD_TURMA)
VALUES (20, 202)

INSERT INTO TB_ALUNOS_TURMA (MATRICULA, COD_TURMA)
VALUES (30, 202)

-- a
SELECT 
	t.NM_TURMA AS Turma,t.HORARIO,
	p.NM_PROFESSOR AS Professor
FROM
	TB_TURMA t 
	JOIN TB_PROFESSOR p 
	ON(t.MATRICULA_PROFESSOR = p.MATRICULA_PROFESSOR);

SELECT * FROM TB_ALUNOS_TURMA tat;

SELECT * FROM  TB_TURMA tt;

-- b
SELECT 
    A.NOME AS Nome_Aluno,
    T.NM_TURMA AS Nome_Turma
FROM 
    TB_ALUNOS_TURMA AT
JOIN 
    TB_ALUNO A ON AT.MATRICULA = A.MATRICULA
JOIN 
    TB_TURMA T ON AT.COD_TURMA = T.COD_TURMA;


-- c
SELECT 
    a.NOME AS Nome_Aluno,
    p.NM_PROFESSOR AS Professor
FROM 
    TB_ALUNOS_TURMA atm
JOIN
    TB_ALUNO a ON atm.MATRICULA = a.MATRICULA
JOIN 
    TB_TURMA t ON atm.COD_TURMA = t.COD_TURMA
JOIN 
	TB_PROFESSOR p ON (t.MATRICULA_PROFESSOR = p.MATRICULA_PROFESSOR);


--D 

SELECT 
	P.NM_PROFESSOR,
	T.NM_TURMA
FROM
	TB_TURMA T
RIGHT JOIN
	TB_PROFESSOR P ON (T.MATRICULA_PROFESSOR = P.MATRICULA_PROFESSOR);

--E

SELECT 
	A.NOME,
	T.NM_TURMA
FROM
    TB_ALUNO A
LEFT JOIN
	TB_ALUNOS_TURMA TM ON (TM.MATRICULA = A.MATRICULA)
LEFT JOIN
	TB_TURMA T ON (T.COD_TURMA = TM.COD_TURMA)
ORDER BY A.NOME ASC;














	
	
	






